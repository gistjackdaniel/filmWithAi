# SceneForge 사용자 인증 플로우 상세 설계

## 개요
이 문서는 SceneForge 애플리케이션의 사용자 인증 프로세스를 상세히 정의합니다.

## 1. 인증 플로우 개요

### 1.1 전체 플로우
```
사용자 → 로그인 화면 → Google OAuth → 인증 성공 → 메인 화면
```

### 1.2 기술 스택
- **프론트엔드**: react-oauth/google SDK
- **백엔드**: Google OAuth 2.0 API
- **데이터베이스**: MongoDB (사용자 정보 저장)
- **상태 관리**: Zustand (인증 상태 관리)

## 2. 상세 사용자 플로우

### 2.1 로그인 화면 진입
**사용자 행동**: 브라우저에서 애플리케이션 접속
**화면**: 로그인 페이지 (LoginPage.jsx)
**처리 과정**:
1. 애플리케이션 초기화
2. 인증 상태 확인 (authStore)
3. 이미 로그인된 경우 → 메인 화면으로 리다이렉트
4. 로그인되지 않은 경우 → 로그인 화면 표시

### 2.2 Google 로그인 버튼 클릭
**사용자 행동**: "Google로 로그인" 버튼 클릭
**화면**: 로그인 페이지 (버튼 활성화 상태)
**처리 과정**:
1. react-oauth/google SDK 초기화
2. Google OAuth 팝업 창 열기
3. 사용자에게 Google 계정 선택 요청

### 2.3 Google 계정 선택 및 권한 승인
**사용자 행동**: Google 계정 선택 후 권한 승인
**화면**: Google OAuth 팝업 창
**처리 과정**:
1. Google에서 사용자 정보 요청
2. 사용자 권한 승인
3. Google에서 인증 코드 반환

### 2.4 인증 성공 처리
**사용자 행동**: 권한 승인 완료
**화면**: 로딩 스피너 표시
**처리 과정**:
1. Google에서 받은 인증 코드를 백엔드로 전송
2. 백엔드에서 Google API로 액세스 토큰 교환
3. 사용자 정보 조회 (이메일, 이름, 프로필 이미지)
4. 데이터베이스에 사용자 정보 저장/업데이트
5. JWT 토큰 생성 및 클라이언트로 반환
6. 클라이언트에서 인증 상태 업데이트 (authStore)

### 2.5 메인 화면 진입
**사용자 행동**: 로딩 완료 후 자동 이동
**화면**: 대시보드 (Dashboard.jsx)
**처리 과정**:
1. 인증 상태 확인
2. 사용자별 프로젝트 목록 로드
3. 대시보드 화면 렌더링

## 3. 예외 상황 처리

### 3.1 로그인 실패
**상황**: Google OAuth 인증 실패
**사용자 경험**:
- 에러 메시지 표시: "로그인에 실패했습니다. 다시 시도해주세요."
- 재시도 버튼 제공
- 로그인 화면 유지

**처리 과정**:
1. 에러 타입 확인 (네트워크 오류, 권한 거부 등)
2. 적절한 에러 메시지 표시
3. 로그인 상태 초기화

### 3.2 네트워크 오류
**상황**: 인터넷 연결 문제
**사용자 경험**:
- 오프라인 상태 안내: "인터넷 연결을 확인해주세요."
- 재연결 시도 버튼 제공

**처리 과정**:
1. 네트워크 상태 확인
2. 오프라인 상태 표시
3. 재연결 시도 기능 제공

### 3.3 권한 거부
**상황**: 사용자가 Google 권한 승인 거부
**사용자 경험**:
- 안내 메시지: "로그인을 위해 Google 계정 권한이 필요합니다."
- 다시 시도 안내

**처리 과정**:
1. 권한 거부 상태 감지
2. 사용자 친화적 메시지 표시
3. 로그인 화면으로 복귀

### 3.4 세션 만료
**상황**: JWT 토큰 만료
**사용자 경험**:
- 자동 로그아웃 처리
- 로그인 화면으로 리다이렉트
- 안내 메시지: "세션이 만료되었습니다. 다시 로그인해주세요."

**처리 과정**:
1. 토큰 만료 감지 (API 응답 401)
2. 인증 상태 초기화
3. 로그인 화면으로 리다이렉트

## 4. 보안 고려사항

### 4.1 데이터 보호
- 사용자 이메일, 이름만 수집
- 민감한 정보는 서버에 저장하지 않음
- HTTPS 통신으로 데이터 암호화

### 4.2 토큰 관리
- JWT 토큰은 클라이언트 메모리에 저장
- 토큰 만료 시 자동 갱신 또는 재로그인
- 로그아웃 시 토큰 무효화

### 4.3 세션 관리
- 사용자별 데이터 격리
- 세션 타임아웃 설정
- 안전한 로그아웃 처리

## 5. 구현 세부사항

### 5.1 프론트엔드 구현
```javascript
// authStore.js - 인증 상태 관리
const useAuthStore = create((set) => ({
  user: null,
  isAuthenticated: false,
  isLoading: false,
  login: async (googleResponse) => {
    // Google 인증 처리
  },
  logout: () => {
    // 로그아웃 처리
  }
}));
```

### 5.2 백엔드 구현
```javascript
// auth.js - 인증 API 엔드포인트
app.post('/api/auth/google', async (req, res) => {
  // Google OAuth 처리
  // 사용자 정보 저장
  // JWT 토큰 생성
});
```

### 5.3 데이터베이스 스키마
```javascript
// User Schema
{
  _id: ObjectId,
  googleId: String,
  email: String,
  name: String,
  profileImage: String,
  createdAt: Date,
  lastLoginAt: Date
}
```

## 6. 테스트 시나리오

### 6.1 정상 플로우 테스트
1. 로그인 화면 접속
2. Google 로그인 버튼 클릭
3. Google 계정 선택 및 권한 승인
4. 메인 화면 진입 확인

### 6.2 예외 상황 테스트
1. 네트워크 오류 시나리오
2. 권한 거부 시나리오
3. 세션 만료 시나리오
4. 로그아웃 기능 테스트

## 7. 성능 요구사항

### 7.1 응답 시간
- 로그인 화면 로드: 2초 이내
- Google OAuth 처리: 5초 이내
- 메인 화면 진입: 3초 이내

### 7.2 가용성
- 인증 서비스 가용성: 99.9%
- 오류 복구 시간: 30초 이내

---

**문서 버전**: 1.0  
**작성일**: 2024년  
**작성자**: SceneForge 개발팀 