# SceneForge 사용자 인증 플로우 설계

## 📋 개요
- **기능**: Google OAuth 2.0 로그인
- **기술 스택**: react-oauth/google SDK
- **목표**: 사용자별 프로젝트 데이터 분리 및 로그인 상태 유지

---

## 🔄 전체 인증 플로우

### 1단계: 앱 진입
**사용자 행동**: 브라우저에서 SceneForge 앱 URL 접속
**화면**: 스플래시 화면 (로딩 애니메이션)
**처리**: 앱 초기화 및 인증 상태 확인

### 2단계: 인증 상태 확인
**사용자 행동**: 자동으로 처리됨 (사용자 개입 없음)
**화면**: 스플래시 화면 유지
**처리**: 
- 로컬 스토리지에서 JWT 토큰 확인
- 토큰 유효성 검증
- 결과에 따라 다음 단계 결정

### 3단계: 로그인 화면 표시
**조건**: 인증되지 않은 사용자
**사용자 행동**: 로그인 화면 확인
**화면**: 
```
┌─────────────────────────────────────┐
│           SceneForge                │
│                                     │
│    🎬 AI 영화 제작 타임라인 툴      │
│                                     │
│    시놉시스 → AI 스토리 → 콘티      │
│    → 타임라인 시각화                │
│                                     │
│    ┌─────────────────────────────┐  │
│    │    Google로 로그인          │  │
│    │    [Google 아이콘]          │  │
│    └─────────────────────────────┘  │
│                                     │
│    * Google 계정으로 간편 로그인     │
│    * 프로젝트 자동 저장 및 동기화    │
└─────────────────────────────────────┘
```

### 4단계: Google 로그인 버튼 클릭
**사용자 행동**: "Google로 로그인" 버튼 클릭
**화면**: 로그인 화면 유지, 버튼에 로딩 상태 표시
**처리**: react-oauth/google SDK 초기화

### 5단계: Google OAuth 팝업/리다이렉트
**사용자 행동**: Google 로그인 페이지에서 계정 선택 및 로그인
**화면**: Google OAuth 팝업 또는 리다이렉트 페이지
**처리**: 
- Google 계정 선택
- 권한 승인 (이메일, 프로필 정보)
- 인증 코드 발급

### 6단계: 인증 코드 처리
**사용자 행동**: 자동으로 처리됨 (사용자 개입 없음)
**화면**: 로딩 화면
```
┌─────────────────────────────────────┐
│                                     │
│           🔄 로그인 중...           │
│                                     │
│    Google 계정으로 인증하고 있습니다 │
│                                     │
│    [스피너 애니메이션]              │
│                                     │
└─────────────────────────────────────┘
```
**처리**: 
- 인증 코드를 서버로 전송
- 서버에서 Google API로 액세스 토큰 교환
- 사용자 정보 조회

### 7단계: 서버 인증 처리
**사용자 행동**: 자동으로 처리됨 (사용자 개입 없음)
**화면**: 로딩 화면 유지
**처리**:
- Google API에서 사용자 정보 조회
- MongoDB에서 사용자 조회/생성
- JWT 토큰 생성
- 클라이언트로 토큰 전송

### 8단계: 인증 성공
**사용자 행동**: 자동으로 처리됨 (사용자 개입 없음)
**화면**: 로딩 화면에서 성공 메시지로 변경
```
┌─────────────────────────────────────┐
│                                     │
│           ✅ 로그인 성공!           │
│                                     │
│    환영합니다, [사용자 이름]님!     │
│                                     │
│    메인 화면으로 이동 중...         │
│                                     │
└─────────────────────────────────────┘
```
**처리**:
- JWT 토큰을 로컬 스토리지에 저장
- 사용자 정보를 React Context에 저장
- 메인 화면으로 리다이렉트

### 9단계: 메인 화면 진입
**사용자 행동**: 자동으로 처리됨 (사용자 개입 없음)
**화면**: 메인 대시보드
```
┌─────────────────────────────────────┐
│ SceneForge    [사용자명] ▼ [로그아웃] │
├─────────────────────────────────────┤
│                                     │
│    🎬 영화 프로젝트 관리            │
│                                     │
│    ┌─────────────┐ ┌─────────────┐  │
│    │ 새 프로젝트 │ │ 프로젝트 목록│  │
│    │   만들기    │ │   보기      │  │
│    └─────────────┘ └─────────────┘  │
│                                     │
│    최근 프로젝트:                   │
│    • [프로젝트명1] - 수정일         │
│    • [프로젝트명2] - 수정일         │
│                                     │
└─────────────────────────────────────┘
```

---

## ⚠️ 예외 상황 처리

### 예외 1: 로그인 실패
**조건**: Google OAuth 인증 실패
**사용자 행동**: 에러 메시지 확인
**화면**: 
```
┌─────────────────────────────────────┐
│           ❌ 로그인 실패            │
│                                     │
│    Google 로그인에 실패했습니다.    │
│    다시 시도해 주세요.              │
│                                     │
│    [다시 시도] [고객지원]           │
└─────────────────────────────────────┘
```

### 예외 2: 네트워크 오류
**조건**: 서버 연결 실패
**사용자 행동**: 재시도 버튼 클릭
**화면**: 
```
┌─────────────────────────────────────┐
│           🌐 연결 오류              │
│                                     │
│    서버에 연결할 수 없습니다.       │
│    인터넷 연결을 확인해 주세요.     │
│                                     │
│    [다시 시도] [오프라인 모드]      │
└─────────────────────────────────────┘
```

### 예외 3: 권한 거부
**조건**: Google 권한 승인 거부
**사용자 행동**: 권한 재설정 안내 확인
**화면**: 
```
┌─────────────────────────────────────┐
│           🔒 권한 필요              │
│                                     │
│    SceneForge 사용을 위해           │
│    Google 계정 권한이 필요합니다.    │
│                                     │
│    [권한 설정] [취소]               │
└─────────────────────────────────────┘
```

---

## 🔧 기술적 구현 세부사항

### 클라이언트 측 (React)
```javascript
// 인증 상태 관리
const [authState, setAuthState] = useState({
  isAuthenticated: false,
  user: null,
  loading: true
});

// Google OAuth 설정
const googleLogin = useGoogleLogin({
  onSuccess: async (response) => {
    // 인증 코드를 서버로 전송
    const result = await authenticateWithServer(response.code);
    if (result.success) {
      setAuthState({
        isAuthenticated: true,
        user: result.user,
        loading: false
      });
    }
  },
  onError: (error) => {
    // 에러 처리
    handleAuthError(error);
  }
});
```

### 서버 측 (Node.js)
```javascript
// Google OAuth 토큰 교환
app.post('/api/auth/google', async (req, res) => {
  try {
    const { code } = req.body;
    
    // Google API로 액세스 토큰 교환
    const tokens = await oauth2Client.getToken(code);
    
    // 사용자 정보 조회
    const userInfo = await getUserInfo(tokens.access_token);
    
    // DB에서 사용자 조회/생성
    let user = await User.findOne({ googleId: userInfo.id });
    if (!user) {
      user = await User.create({
        googleId: userInfo.id,
        email: userInfo.email,
        name: userInfo.name
      });
    }
    
    // JWT 토큰 생성
    const token = jwt.sign({ userId: user._id }, process.env.JWT_SECRET);
    
    res.json({ success: true, token, user });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});
```

---

## 📊 성공 지표

### 인증 성공률
- **목표**: 95% 이상의 로그인 성공률
- **측정**: 로그인 시도 대비 성공 비율

### 사용자 경험
- **목표**: 3초 이내 로그인 완료
- **측정**: 로그인 버튼 클릭부터 메인 화면 진입까지

### 에러 처리
- **목표**: 모든 예외 상황에 대한 명확한 안내
- **측정**: 사용자 피드백 및 재시도율

---

## 🔄 로그아웃 플로우

### 1단계: 로그아웃 버튼 클릭
**사용자 행동**: 헤더의 로그아웃 버튼 클릭
**화면**: 확인 모달
```
┌─────────────────────────────────────┐
│           로그아웃 확인             │
│                                     │
│    정말 로그아웃 하시겠습니까?      │
│                                     │
│    [로그아웃] [취소]                │
└─────────────────────────────────────┘
```

### 2단계: 로그아웃 처리
**사용자 행동**: "로그아웃" 버튼 클릭
**화면**: 로그인 화면으로 리다이렉트
**처리**:
- 로컬 스토리지에서 JWT 토큰 삭제
- React Context 상태 초기화
- 로그인 화면으로 이동

---

**문서 버전**: 1.0  
**최종 수정일**: 2024년  
**작성자**: SceneForge 개발팀 